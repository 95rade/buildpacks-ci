#!/usr/bin/env ruby

Dir["pipelines/*.yml"].each do |filename|
  name = File.basename(filename, '.yml')
  system("fly -t buildpacks c #{name} -c pipelines/#{name}.yml -vf private.yml")
end

Dir["config/bosh-lite/*.yml"].each do |filename|
  deployment_name = File.basename(filename, '.yml')
  system("fly -t buildpacks c #{deployment_name} -c pipelines/templates/bosh-lite.yml -vf private.yml -vf #{filename}")
end

Dir["config/buildpack/*.yml"].each do |filename|
  language = File.basename(filename, '.yml')
  system("erb language=#{language} pipelines/templates/buildpack.yml > /tmp/pipeline.yml")
  system("fly -t buildpacks c #{language}-buildpack -c /tmp/pipeline.yml -vf private.yml -vf #{filename}")
end

puts "Thanks, JT"
