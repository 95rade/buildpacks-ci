#!/bin/sh

release_names=`ls | grep buildpack-github-release | sed 's/-buildpack-github-release//g'`

for name in $release_names; do
  mkdir -p cf-release/blobs/$name-buildpack
  case $name in
      *offline*) filename=`cat cf-release/config/blobs.yml | grep java-buildpack-offline | cut -d ':' -f 1`;;
      *java*)    filename=`cat cf-release/config/blobs.yml | grep java-buildpack-v | cut -d ':' -f 1`;;
      *)         filename=`cat cf-release/config/blobs.yml | grep $name-buildpack | cut -d ':' -f 1`;;
  esac
  mv $name-buildpack-github-release/*.zip cf-release/blobs/$filename
done

cd cf-release
bundle
bosh create release --force --with-tarball --name cf --version 212.0.`date +"%s"`
