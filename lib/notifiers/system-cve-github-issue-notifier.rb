# encoding: utf-8
require 'octokit'

class SystemCVEGithubIssueNotifier
  def self.notify!(cves, related_to_stacks)
    return unless related_to_stacks
    Octokit.auto_paginate = true
    Octokit.configure do |c|
      c.login    = ENV.fetch('GITHUB_USERNAME')
      c.password = ENV.fetch('GITHUB_PASSWORD')
    end
    cves.each do |cve|
      Octokit.create_issue(
        'pivotal-cf/pcf-security-notices',
        cve[:title],
        "```\n#{cve[:description]}\n```"
      )
    end
  end
end
