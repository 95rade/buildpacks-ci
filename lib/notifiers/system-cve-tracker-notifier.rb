# encoding: utf-8
require_relative '../tracker-client'

class SystemCVETrackerNotifier
  def self.notify!(cves, related_to_stacks)
    return if !related_to_stacks || cves.empty?
    cve_titles = cves.map { |c| c[:title] }
    tracker_title = "address: #{cve_titles.join(', ')}"
    tracker_description = cves.map { |cve| cve[:description] }.join("\n\n--------\n\n")

    tracker_client = TrackerClient.new(
      ENV['TRACKER_API_TOKEN'],
      ENV['TRACKER_PROJECT_ID'],
      ENV['TRACKER_REQUESTER_ID'].to_i
    )

    tracker_client.post_to_tracker tracker_title, tracker_description
  end
end
